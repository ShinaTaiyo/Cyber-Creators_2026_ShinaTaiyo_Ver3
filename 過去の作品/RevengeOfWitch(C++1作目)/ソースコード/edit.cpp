//=========================================================================================================================
//
//７月１１日：オブジェクトのRelease方法を変更[Edit.cpp]
//Author:ShinaTaiyo
//
//=========================================================================================================================

//=============================================================
//インクルード
//=============================================================
#include "edit.h"
#include "bg.h"
#include "item.h"
#include "fade.h"
#include "manager.h"
#include "input.h"
#include "marker.h"
//=========================================================================================================================

//=============================================================
//静的メンバ宣言
//=============================================================
CPlayer* CEdit::m_pPlayer = nullptr;
CStageManager* CEdit::m_pStageManager = nullptr;
CBg3D* CEdit::m_pBg3D = nullptr;
CField* CEdit::m_pField = nullptr;

//=============================================================
//コンストラクタ
//=============================================================
CEdit::CEdit()
{
	m_pStageManager = nullptr;
	m_pPlayer = nullptr;
}
//=========================================================================================================================

//=============================================================
//デストラクタ
//=============================================================
CEdit::~CEdit()
{

}
//=========================================================================================================================

//=============================================================
//初期化処理
//=============================================================
HRESULT CEdit::Init()
{
	CScene::Init();//シーン初期化処理
	//============================
	//各オブジェクト生成処理
	//============================

	//======================================================

	//============================
	//ステージマネージャーの生成
	//============================
	m_pStageManager = CStageManager::Create();
	//m_pStageManager->LoadMapBin(1);//マップをバイナリファイルから読み込む
	m_pStageManager->LoadMapTxt(0);   //マップをテキストファイルから読み込む
	//======================================================
	//m_pPlayer = CPlayer::Create(D3DXVECTOR3(0.0f, 0.0f, 0.0f), NULL_VECTOR3, NULL_VECTOR3, ONE_VECTOR3);

	return S_OK;
}
//=========================================================================================================================

//=============================================================
//終了処理
//=============================================================
void CEdit::Uninit()
{
	m_pStageManager->SaveMapTxt(m_pStageManager->GetMapIndex());

	//===================================
    //3D背景の破棄
    //===================================
	if (m_pBg3D != nullptr)
	{
		m_pBg3D->SetUseDeath(true);
		m_pBg3D->CObject::SetDeath();
		m_pBg3D = nullptr;
	}
	//====================================================================

	//===================================
	//フィールドの破棄
	//===================================
	if (m_pField != nullptr)
	{
		m_pField->SetUseDeath(true);
		m_pField->CObject::SetDeath();
		m_pField = nullptr;
	}
	//====================================================================

	//===================================
	//ステージマネージャーの破棄
	//===================================
	if (m_pStageManager != nullptr)
	{
		m_pStageManager->SetUseDeath(true);
		m_pStageManager->CObject::SetDeath();
		m_pStageManager = nullptr;
	}
	//====================================================================

	//============================================
	//プレイヤーの破棄
	//============================================
	if (m_pPlayer != nullptr)
	{
		m_pPlayer->SetUseDeath(true);
		m_pPlayer->SetDeath();
		m_pPlayer = nullptr;
	}
	//=====================================================================
	CScene::Uninit();//シーン終了処理
}
//=========================================================================================================================

//=============================================================
//更新処理
//=============================================================
void CEdit::Update()
{
	if (CManager::GetInputKeyboard()->GetTrigger(DIK_O) == true)
	{
		CManager::GetSceneFade()->SetSceneFade(CFade::FADEMODE_IN, CScene::MODE_TITLE);
	}
}
//=========================================================================================================================